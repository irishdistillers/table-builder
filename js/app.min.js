"use strict";var rsTableBuilder={globals:{name:$('input[name="save-table-name"]'),saveDownload:$(".save-download"),saveBar:$(".save-table-area"),addRow:$("#add-row"),addCol:$("#add-col"),output:$(".save-table-btn"),clear:$(".clear-table-btn")},empty:{name:"",id:!1,headers:[{title:"Header"},{title:"Header"}],rows:[{cols:[{content:!1},{content:!1}]},{cols:[{content:!1},{content:!1}]}]},config:{},clearTable:function(t){return t.html("")},makeDroppable:function(t){var e=this,a=void 0;document.addEventListener("drag",function(t){"BUTTON"===t.srcElement.tagName&&(a=$(t.target).attr("type"))}),document.addEventListener("dragover",function(t){t.preventDefault()}),document.addEventListener("drop",function(n){n.preventDefault();var i=n.target;i.classList.contains("droptarget")||(i=$(i).closest(".droptarget").get(0)),"title"===a&&"0"===$(i).attr("data-td-index")&&i&&i.classList.contains("droptarget")?e.onDrop(i,a,t):"title"!==a&&i&&i.classList.contains("droptarget")&&e.onDrop(i,a,t)})},onDrop:function(t,e,a){var n=parseInt($(t).attr("data-tr-index"),10),i=parseInt($(t).attr("data-td-index"),10),o=!1;e.match(/gen-text/gi)&&(o='<span data-inline-text="true">Click me to edit text.<span>'),e.match(/check/gi)&&(o="offered"),e.match(/times/gi)&&(o="notOffered"),e.match(/title/gi)&&(o='<p data-feat-title="true">Feature Title</p>'),this.config.rows[n].cols[i].content=o,this.saveLocal(),this.renderTable(a,!0)},renderTable:function(t,e){var a=this;this.clearTable(t),this.globals.name.val(this.config.name);var n=this.config.id?this.config.id:this.uuid(),i='<table class="productTable" id="rs-table-'+n+'">';if(this.config.headers.length>0&&(i+='\n        <thead class="productTable-header">\n          <tr class="productTable-row">',$.each(this.config.headers,function(t,a){var n=e?'<span contenteditable="true">'+a.title+"</span>":a.title;i+='<th class="productTable-name"'+(e?' style="position:relative;"':"")+(e?' data-th-index="'+t+'"':"")+">"+n+(e?'<button data-index="'+t+'" class="remove-col"></button>':"")+"</th>"}),i+="\n          </tr>\n        </thead>"),this.config.rows.length>0){i+='<tbody">';var o=Array.from({length:this.config.rows.length}).map(function(t,e){return e}).reverse();$.each(this.config.rows,function(t,a){var n=e?' style="z-index:'+o[t]+';"':"";i+='<tr class="productTable-row"'+n+">",a.cols.length>0&&$.each(a.cols,function(n,r){var s="",l="productTable-feature";r.content?("offered"===r.content||"notOffered"===r.content?l=l+"Item "+r.content:(s=r.content).match(/data-feat-title="true"/gi)?s=e?'<span contenteditable="true">'+s+"</span>":s:l+="Item",e||(s=(s=(s=s.replace(/ data-feat-title="true"/gi,"")).replace(/ data-inline-text="true"/gi,"")).replace(/ contenteditable="true"/gi,""))):s=e?'<span class="drop-hint">drop item here</span>':"";var d=e?' style="position:relative;z-index:'+o[t]+';"':"",c=e?'data-tr-index="'+t+'" data-td-index="'+n+'"':"",u=e?" droptarget":"",f=e&&n===a.cols.length-1?'<button data-index="'+t+'" class="remove-row"></button>':"";i+="<td "+c+' class="'+l+u+'"'+d+">"+s+f+"</td>"}),i+="</tr>"}),i+="</tbody>"}i+="</table>";var r='\n      <style type="text/css">\n        table#rs-table-'+n+" tbody tr td {\n          width: unset;\n        }\n      </style>\n    ";t.html(""+r+i),e||(this.output=""+r+i),this.packageForSave(),e&&(t.find("tbody tr .remove-row").click(function(e){a.removeRow(e,t)}),t.find("thead tr .remove-col").click(function(e){a.removeColumn(e,t)}),t.find("tbody tr td").each(function(){var e=this,a=$(this).find("span");if(a.length&&a.attr("data-inline-text")){new Quill(a.get(0),{modules:{toolbar:[["bold","italic","underline"],["image"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{align:[]}]]},theme:"bubble"});a.on("focusout",function(){console.log("save text"),rsTableBuilder.updateText(t,$(e))})}}),t.find("thead th").each(function(){var e=$(this);e.find('span[contenteditable="true"]').on("focusout",function(a){rsTableBuilder.updateHeader(t,e,a.target)}),e.hover(function(){t.find("tbody tr").each(function(){$(this).find("td").eq(e.index()).addClass("hover-col")})},function(){t.find("tbody tr").each(function(){$(this).find("td").eq(e.index()).removeClass("hover-col")})})})),t.find("table.productTable").responsiveTable()},updateText:function(t,e){var a=parseInt(e.attr("data-tr-index"),10),n=parseInt(e.attr("data-td-index"),10),i=e.find("span > .ql-editor").html(),o=e.find("span").attr("data-feat-title")?' data-feat-title="true"':"";this.config.rows[a].cols[n].content='<span data-inline-text="true"'+o+">"+i+"</span>",this.saveLocal(),this.renderTable(t,!0)},updateHeader:function(t,e,a){var n=parseInt(e.attr("data-th-index"),10),i=$(a).text();this.config.headers[n].title=i,this.saveLocal(),this.renderTable(t,!0)},addRow:function(t){for(var e=this.config.headers.length,a=[],n=0;n<e;n+=1)a.push({content:!1});this.config.rows.push({cols:a}),this.saveLocal(),this.renderTable(t,!0)},removeRow:function(t,e){var a=parseInt($(t.target).attr("data-index"),10);this.config.rows.splice(a,1),this.saveLocal(),this.renderTable(e,!0)},addColumn:function(t){this.config.headers.push({title:"Header"}),$.each(this.config.rows,function(t,e){e.cols.push({content:!1})}),this.saveLocal(),this.renderTable(t,!0)},removeColumn:function(t,e){var a=parseInt($(t.target).attr("data-index"),10);this.config.headers.splice(a,1),$.each(this.config.rows,function(t,e){e.cols.splice(a,1)}),this.saveLocal(),this.renderTable(e,!0)},uuid:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return""+t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},saveLocal:function(){localStorage.setItem("SAVED_TABLE",JSON.stringify(this.config))},file:null,output:"",openSave:function(t){rsTableBuilder.renderTable(t),rsTableBuilder.renderTable(t,!0),console.log(rsTableBuilder.output),rsTableBuilder.globals.saveBar.slideToggle(200)},packageForSave:function(){this.globals.name.val(this.config.name);var t=this.config.name;""===t.trim()&&(t="table-generated-file");var e=this.globals.saveDownload,a=new Blob([JSON.stringify(this.config)],{type:"application/json"});null!==this.file&&window.URL.revokeObjectURL(this.file),this.file=window.URL.createObjectURL(a),e.attr("href",this.file),e.attr("download",t+".json")},bindImport:function(t){var e=this,a=$("#import-table");a.get(0).ondragover=function(){return a.addClass("hover-file"),!1},a.get(0).ondragleave=function(){return a.removeClass("hover-file"),!1},a.get(0).ondrop=function(n){a.removeClass("hover-file"),n.preventDefault();var i=n.dataTransfer.files[0];if(i.name.split(".").pop().match(/json/gi)){var o=new FileReader;o.onload=function(n){a.removeClass("wrong-file-type"),e.config=JSON.parse(n.target.result),e.saveLocal(),e.renderTable(t,!0),a.addClass("correct-file-type"),setTimeout(function(){a.removeClass("correct-file-type")},1500)},o.readAsText(i)}else a.addClass("wrong-file-type"),setTimeout(function(){a.removeClass("wrong-file-type")},2e3);return!1}},updateTableName:function(t,e){this.config.name=t,this.saveLocal(),this.renderTable(e,!0)},nameTimeOut:null,init:function(t){var e=this;this.globals.name.on("input",function(a){clearTimeout(e.nameTimeOut),e.nameTimeOut=setTimeout(function(){e.updateTableName(a.target.value,t)},250)}),this.globals.addRow.click(function(){e.addRow(t)}),this.globals.addCol.click(function(){e.addColumn(t)}),this.globals.output.click(function(){e.openSave(t)}),this.globals.clear.click(function(){e.config=JSON.parse(JSON.stringify(e.empty)),e.saveLocal(),e.renderTable(t,!0)}),this.bindImport(t),this.renderTable(t,!0),this.makeDroppable(t)}};localStorage.SAVED_TABLE?rsTableBuilder.config=JSON.parse(localStorage.SAVED_TABLE):rsTableBuilder.config=JSON.parse(JSON.stringify(rsTableBuilder.empty)),rsTableBuilder.init($("#table-output"));